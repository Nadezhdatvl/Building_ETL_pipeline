# Building_ETL_pipeline
Karpov courses

# Проект 1: Построение ETL-Пайплайна (DAG_ETL_TVL)

#### Описане проекта:
В этом проекте я буду решать задачу на ETL схему и как это можно сделать при помощи библиотеки Airflow.
В целом Airflow — это удобный инструмент для решения ETL-задач.
Ожидается, что на выходе будет DAG в Airflow, который будет считаться каждый день за вчера.

#### Задача:
* Параллельно обрабатываются две таблицы. В feed_actions для каждого юзера посчитала число просмотров и лайков контента. В message_actions для каждого юзера считаю, сколько он получает и отсылает сообщений, скольким людям он пишет, сколько людей пишут ему. Каждая выгрузка должна быть в отдельном таске.
* Далее объединяю две таблицы в одну.
* Для этой таблицы считаю все эти метрики в разрезе по полу, возрасту и ос. Делаю три разных таска на каждый срез.
* И финальные данные со всеми метриками записываю в отдельную таблицу в ClickHouse.
* Каждый день таблица должна дополняться новыми данными.

#### Структура финальной таблицы должна быть такая:

* Дата - event_date
* Название среза - dimension
* Значение среза - dimension_value
* Число просмотров - views
* Числой лайков - likes
* Число полученных сообщений - messages_received
* Число отправленных сообщений - messages_sent
* От скольких пользователей получили сообщения - users_received
* Скольким пользователям отправили сообщение - users_sent
* Срез - это os, gender и age
И таблицу необходимо загрузить в схему test.

#### Стек:
* ClickHouse
* SQL Lab
* JUPYTERHUB
* Redash
* Airflow
* Python
* библиотеки: pandas, pandahouse, datetime, timedelta, numpy
* для создания DAG-а и его «содержания»: airflow, DAG,task,  airflow.operators.python_operator, PythonOperator, datetime, airflow.decorators


# Проект 2: Автоматизация отчетности (DAG_report_TVL, DAG_report_mess_TVL)

#### Описане проекта:
Здесь я автоматизировала базовую отчетность нашего приложения. Наладила автоматическую отправку аналитической сводки в телеграм каждое утро!

#### Задача:
* Создадю своего телеграм-бота с помощью @botfather. Чтобы получить chat_id, воспользовалась ссылкой https://api.telegram.org/bot<токен_вашего_бота>/getUpdates  или методом bot.getUpdates()
* Напиcала скрипт для сборки отчета по ленте новостей. Отчет должен состоять из двух частей:
  1.Текст с информацией о значениях ключевых метрик за предыдущий день
  2.График с значениями метрик за предыдущие 7 дней
* Отобразила в отчете следующие ключевые метрики: DAU, Просмотры, Лайки, CTR
* Автоматизировала отправку отчета с помощью Airflow. Код для сборки отчета разместила в GitLab
* Отчет приходит ежедневно в 11:00 в свой чат.

#### Стек:
* ClickHouse
* SQL Lab
* JUPYTERHUB
* Redash
* Airflow
* Python
* библиотеки: pandas, pandahouse, datetime, timedelta, numpy, telegram, matplotlib.pyplot, seaborn, io,
* для создания DAG-а и его «содержания»: airflow, DAG,task,  airflow.operators.python_operator, PythonOperator, datetime, airflow.decorators, get_current_context

# Проект 3: Поиск аномалий. Система алертов. (DAG_alert_TVL)

#### Задача:

* Система с периодичность каждые 15 минут проверяет ключевые метрики, такие как активные пользователи в ленте / мессенджере, просмотры, лайки, CTR, количество отправленных сообщений.
* Изучила поведение метрик и подобрала наиболее подходящий метод для детектирования аномалий. На практике как правило применяются статистические методы. В самом простом случае можно, например, проверять отклонение значения метрики в текущую 15-минутку от значения в такую же 15-минутку день назад.
* В случае обнаружения аномального значения, в чат отправляется алерт - сообщение со следующей информацией: метрика, ее значение, величина отклонения.
* В сообщение добавила дополнительную информацию, которая поможет при исследовании причин возникновения аномалии. Например,  график, ссылки на дашборд/чарт в BI системе.
* Пример шаблона алерта:
Метрика {metric_name} в срезе {group}.
Текущее значение {current_x}. Отклонение более {x}%.[опционально: ссылка на риалтайм чарт этой метрики в BI для более гибкого просмотра]
[опционально: ссылка на риалтайм дашборд в BI для исследования ситуации в целом] @[опционально: тегаем ответственного/наиболее заинтересованного человека в случае отклонения конкретно этой метрики в этом срезе (если такой человек есть)]
[график]
* Автоматизировала систему алертов с помощью Airflow.

#### Стек:
* ClickHouse
* SQL Lab
* JUPYTERHUB
* Redash
* Airflow
* Python
* библиотеки: pandas, pandahouse, datetime, timedelta, numpy, telegram, matplotlib.pyplot, seaborn, io,
для создания DAG-а и его «содержания»: airflow, DAG,task,  airflow.operators.python_operator, PythonOperator, datetime, airflow.decorators, get_current_context
